# AMI Server

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯èª¿æŸ»ã®ãŸã‚ã®FastAPIãƒ™ãƒ¼ã‚¹ã®REST APIãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã€‚Neo4j Auraãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã—ã€Google Cloud Runã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Cloud Run                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      AMI Server                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ æ¤œç´¢    â”‚  â”‚ãƒãƒƒãƒˆãƒ¯  â”‚  â”‚ CypherğŸ”’ â”‚  â”‚ ãƒ˜ãƒ«ã‚¹    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  API    â”‚  â”‚ãƒ¼ã‚¯ API  â”‚  â”‚   API    â”‚  â”‚ ãƒã‚§ãƒƒã‚¯  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚       â”‚            â”‚             â”‚                        â”‚  â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  â”‚
â”‚  â”‚                    â”‚                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚  â”‚
â”‚  â”‚  â”‚ èªè¨¼ API   â”‚   â”‚   â”‚   SQLite     â”‚                   â”‚  â”‚
â”‚  â”‚  â”‚ (JWT/OAuth)â”‚â”€â”€â”€â”¼â”€â”€â”€â”‚ (ãƒ¦ãƒ¼ã‚¶ãƒ¼DB)  â”‚                   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  â”‚
â”‚  â”‚                    â”‚        â”‚ Cloud Storage ãƒã‚¦ãƒ³ãƒˆ        â”‚  â”‚
â”‚  â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”‚                             â”‚  â”‚
â”‚  â”‚             â”‚  Neo4j      â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚             â”‚  Driver     â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚             â”‚  (éåŒæœŸ)    â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚        â”‚
                        â–¼        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Neo4j Aura    â”‚  â”‚ Cloud Storage   â”‚
              â”‚  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹   â”‚  â”‚  /data/ami.db   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ğŸ”’ = èªè¨¼ãŒå¿…è¦

## âœ¨ æ©Ÿèƒ½

### ã‚³ã‚¢API

1. **æ¤œç´¢ãƒãƒ¼ãƒ‰API** (`/api/v1/search/`) ğŸ”’
   - `node_id`ã§ãƒãƒ¼ãƒ‰ã‚’æ¤œç´¢
   - åå‰ã§æ¤œç´¢ï¼ˆéƒ¨åˆ†ä¸€è‡´ï¼‰
   - `limit`ã¨`offset`ã«ã‚ˆã‚‹ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
   - ãƒãƒ¼ãƒ‰ãƒ©ãƒ™ãƒ«ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

2. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯API** (`/api/v1/network/`) ğŸ”’
   - ãƒãƒ¼ãƒ‰ã®éš£æ¥ãƒãƒ¼ãƒ‰ã‚’å–å¾—
   - ãƒ©ãƒ™ãƒ«ã§éš£æ¥ãƒãƒ¼ãƒ‰ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
   - ãƒãƒ¼ãƒ‰é–“ã®æœ€çŸ­çµŒè·¯ã‚’æ¤œç´¢

3. **éåŒæœŸCypher API** (`/api/v1/cypher/`) ğŸ”’
   - ä»»æ„ã®Cypherã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œï¼ˆèªè¨¼å¿…é ˆï¼‰
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã‚’å–å¾—
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±è¨ˆã‚’å–å¾—

4. **èªè¨¼API** (`/api/v1/auth/`)
   - JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ãŸOAuth2ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³ã¨ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹åŒ–ï¼‰
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—
   - SQLiteãƒ™ãƒ¼ã‚¹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

### ã‚°ãƒ©ãƒ•ã‚¹ã‚­ãƒ¼ãƒ

**ãƒãƒ¼ãƒ‰ãƒ©ãƒ™ãƒ«:**
- `officer`: å½¹å“¡ãŠã‚ˆã³æ ªä¸»
- `entity`: æ³•äººã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
- `intermediary`: ä»²ä»‹è€…
- `address`: ä½æ‰€

**ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã‚¿ã‚¤ãƒ—:**
- `å½¹å“¡`: å½¹å“¡é–¢ä¿‚
- `ä»²ä»‹`: ä»²ä»‹é–¢ä¿‚
- `æ‰€åœ¨åœ°`: æ‰€åœ¨åœ°é–¢ä¿‚
- `ç™»éŒ²ä½æ‰€`: ç™»éŒ²ä½æ‰€é–¢ä¿‚
- `åŒåäººç‰©`: åŒåã®äººç‰©
- `åŒä¸€äººç‰©?`: åŒä¸€äººç‰©ã®å¯èƒ½æ€§

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

ã‚µãƒ–ã‚°ãƒ©ãƒ•ã®çµæœã¯ã€å¯è¦–åŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ç°¡å˜ã«çµ±åˆã§ãã‚‹æ§‹é€ åŒ–ã•ã‚ŒãŸJSONã‚¹ã‚­ãƒ¼ãƒã«å¾“ã„ã¾ã™ï¼š

```json
{
  "nodes": [
    {
      "id": "4:abc:123",
      "node_id": 12345,
      "label": "æ³•äºº",
      "properties": {
        "name": "ä¼šç¤¾å",
        "status": "Active"
      }
    }
  ],
  "links": [
    {
      "id": "5:abc:456",
      "source": "4:abc:123",
      "target": "4:abc:789",
      "type": "å½¹å“¡",
      "properties": {}
    }
  ]
}
```

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### å‰ææ¡ä»¶

- Python 3.12ä»¥ä¸Š
- Neo4j Auraãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º

1. **ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³**
   ```bash
   git clone https://github.com/new-village/ami-server.git
   cd ami-server
   ```

2. **ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ**
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Linux/macOS
   # ã¾ãŸã¯
   .venv\Scripts\activate  # Windows
   ```

3. **ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   ```bash
   pip install -r requirements-dev.txt
   ```

4. **ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š**
   
   `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ:
   ```env
   # Neo4jæ¥ç¶š
   NEO4J_URL=neo4j+s://your-instance.databases.neo4j.io
   NEO4J_USERNAME=neo4j
   NEO4J_PASSWORD=your-password
   
   # èªè¨¼
   SECRET_KEY=your-secret-key-change-in-production
   DATABASE_PATH=./ami.db
   FIRST_ADMIN_USER=admin
   FIRST_ADMIN_PASSWORD=your-admin-password
   ```

5. **ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•**
   ```bash
   uvicorn app.main:app --reload --port 8080
   ```

6. **APIã«ã‚¢ã‚¯ã‚»ã‚¹**
   - Swagger UI: http://localhost:8080/docs
   - ReDoc: http://localhost:8080/redoc
   - OpenAPI JSON: http://localhost:8080/openapi.json

### ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pytest

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§å®Ÿè¡Œ
pytest --cov=app --cov-report=html

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
pytest tests/test_search.py -v
```

## ğŸ³ Docker

### ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰

```bash
docker build -t ami-server .
```

### ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œ

```bash
docker run -p 8080:8080 \
  -e NEO4J_URL=neo4j+s://your-instance.databases.neo4j.io \
  -e NEO4J_USERNAME=neo4j \
  -e NEO4J_PASSWORD=your-password \
  ami-server
```

## â˜ï¸ Google Cloud Runãƒ‡ãƒ—ãƒ­ã‚¤

### gcloud CLIã‚’ä½¿ç”¨

1. **Container Registryã«ãƒ“ãƒ«ãƒ‰ã—ã¦ãƒ—ãƒƒã‚·ãƒ¥**
   ```bash
   gcloud builds submit --tag gcr.io/YOUR_PROJECT_ID/ami-server
   ```

2. **Cloud Runã«ãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   gcloud run deploy ami-server \
     --image gcr.io/YOUR_PROJECT_ID/ami-server \
     --platform managed \
     --region asia-northeast1 \
     --allow-unauthenticated \
     --set-secrets=NEO4J_URL=neo4j-url:latest,NEO4J_USERNAME=neo4j-username:latest,NEO4J_PASSWORD=neo4j-password:latest
   ```

### ç’°å¢ƒå¤‰æ•°

| å¤‰æ•° | èª¬æ˜ | å¿…é ˆ |
|------|------|------|
| `NEO4J_URL` | Neo4jæ¥ç¶šURL | ã¯ã„ |
| `NEO4J_USERNAME` | Neo4jãƒ¦ãƒ¼ã‚¶ãƒ¼å | ã¯ã„ |
| `NEO4J_PASSWORD` | Neo4jãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | ã¯ã„ |
| `SECRET_KEY` | JWTç½²åç”¨ç§˜å¯†éµ | ã¯ã„ |
| `DATABASE_PATH` | SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ | ã¯ã„ |
| `FIRST_ADMIN_USER` | åˆæœŸç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼å | ã¯ã„ |
| `FIRST_ADMIN_PASSWORD` | åˆæœŸç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | ã¯ã„ |
| `ALGORITHM` | JWTã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  | ã„ã„ãˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: HS256ï¼‰ |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ï¼ˆåˆ†ï¼‰ | ã„ã„ãˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 15ï¼‰ |
| `REFRESH_TOKEN_EXPIRE_DAYS` | ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ï¼ˆæ—¥ï¼‰ | ã„ã„ãˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 7ï¼‰ |
| `DEBUG` | ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ– | ã„ã„ãˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰ |

## ğŸ“– APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### æ¤œç´¢API (ğŸ”’ èªè¨¼å¿…é ˆ)

#### å…¨ãƒ©ãƒ™ãƒ«ã‚’æ¤œç´¢
```http
GET /api/v1/search?node_id={node_id}&limit={limit}&offset={offset}
GET /api/v1/search?name={name}&limit={limit}&offset={offset}
Authorization: Bearer <token>
```

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:
- `node_id` (ä»»æ„): node_idã§æ¤œç´¢ï¼ˆå®Œå…¨ä¸€è‡´ï¼‰
- `name` (ä»»æ„): åå‰ã§æ¤œç´¢ï¼ˆéƒ¨åˆ†ä¸€è‡´ã€å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ãªã—ï¼‰
- `limit` (ä»»æ„): è¿”ã™çµæœã®æœ€å¤§æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100ã€æœ€å¤§: 1000ï¼‰
- `offset` (ä»»æ„): ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã«ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹çµæœæ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰

#### ç‰¹å®šãƒ©ãƒ™ãƒ«ã§æ¤œç´¢
```http
GET /api/v1/search/{label}?node_id={node_id}&limit={limit}&offset={offset}
GET /api/v1/search/{label}?name={name}&limit={limit}&offset={offset}
Authorization: Bearer <token>
```

åˆ©ç”¨å¯èƒ½ãªãƒ©ãƒ™ãƒ«: `officer`, `entity`, `intermediary`, `address`

#### åˆ©ç”¨å¯èƒ½ãªãƒ©ãƒ™ãƒ«ã‚’å–å¾—
```http
GET /api/v1/search/labels
Authorization: Bearer <token>
```

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯API (ğŸ”’ èªè¨¼å¿…é ˆ)

#### éš£æ¥ãƒãƒ¼ãƒ‰å–å¾—
```http
GET /api/v1/network/neighbors/{node_id}
GET /api/v1/network/neighbors/{node_id}?label={label}&limit={limit}
Authorization: Bearer <token>
```

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:
- `label` (ä»»æ„): éš£æ¥ãƒãƒ¼ãƒ‰ã‚’ãƒ©ãƒ™ãƒ«ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° (`officer`, `entity`, `intermediary`, `address`)
- `limit` (ä»»æ„): æœ€å¤§å–å¾—æ•° (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100)

#### æœ€çŸ­çµŒè·¯æ¤œç´¢
```http
GET /api/v1/network/shortest-path?start_node_id={id1}&end_node_id={id2}
GET /api/v1/network/shortest-path?start_node_id={id1}&end_node_id={id2}&max_hops={hops}
Authorization: Bearer <token>
```

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:
- `max_hops` (ä»»æ„): æ¢ç´¢ã™ã‚‹çµŒè·¯é•·ã®ä¸Šé™ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 4ã€ç¯„å›²: 1-10)

#### ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—å–å¾—
```http
GET /api/v1/network/relationships/{node_id}
GET /api/v1/network/relationships/{node_id}?rel_type={type}&limit={limit}
Authorization: Bearer <token>
```

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:
- `rel_type` (ä»»æ„): ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã‚¿ã‚¤ãƒ—ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- `limit` (ä»»æ„): æœ€å¤§å–å¾—æ•° (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100)

ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
```json
{
  "relationships": [
    {
      "id": "5:abc:456",
      "source": "4:abc:123",
      "target": "4:abc:789",
      "type": "å½¹å“¡",
      "properties": {}
    }
  ]
}
```

#### ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã‚¿ã‚¤ãƒ—å–å¾—
```http
GET /api/v1/network/relationship-types
Authorization: Bearer <token>
```

### Cypher API (ğŸ”’ èªè¨¼å¿…é ˆ)

#### ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
```http
POST /api/v1/cypher/execute
Authorization: Bearer <token>
Content-Type: application/json

{
  "query": "MATCH (n) RETURN n LIMIT 10",
  "parameters": {}
}
```

#### ã‚¹ã‚­ãƒ¼ãƒå–å¾—
```http
GET /api/v1/cypher/schema
```

#### çµ±è¨ˆå–å¾—
```http
GET /api/v1/cypher/stats
```

### èªè¨¼API

èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã¯çŸ­å‘½ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ15åˆ†ï¼‰ã¨é•·å‘½ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ7æ—¥é–“ï¼‰ã‚’ä½¿ç”¨ã—ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚„ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–ãŒå¯èƒ½ãªå®‰å…¨ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã‚’æä¾›ã—ã¾ã™ã€‚

#### ãƒ­ã‚°ã‚¤ãƒ³
```http
POST /api/v1/auth/login
Content-Type: application/x-www-form-urlencoded

username=admin&password=admin
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "abc123...",
  "token_type": "bearer"
}
```

#### ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°
æœ‰åŠ¹ãªãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦æ–°ã—ã„ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¾ã™ã€‚ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚‚ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã¾ã™ï¼ˆæ–°ã—ã„ã‚‚ã®ãŒç™ºè¡Œã•ã‚Œã¾ã™ï¼‰ã€‚
```http
POST /api/v1/auth/refresh
Content-Type: application/json

{
  "refresh_token": "abc123..."
}
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "xyz789...",
  "token_type": "bearer"
}
```

#### ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
ç‰¹å®šã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¦ãã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’çµ‚äº†ã—ã¾ã™ã€‚
```http
POST /api/v1/auth/logout
Content-Type: application/json

{
  "refresh_token": "abc123..."
}
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
```json
{
  "message": "Successfully logged out"
}
```

#### å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ (ğŸ”’ èªè¨¼å¿…é ˆ)
ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã™ã¹ã¦ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã€‚
```http
POST /api/v1/auth/logout-all
Authorization: Bearer <access_token>
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
```json
{
  "message": "Successfully logged out from 3 session(s)"
}
```

#### ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾— (ğŸ”’ èªè¨¼å¿…é ˆ)
```http
GET /api/v1/auth/me
Authorization: Bearer <access_token>
```

### ãƒ˜ãƒ«ã‚¹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

```http
GET /health    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä»˜ããƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
GET /ready     # ãƒ¬ãƒ‡ã‚£ãƒã‚¹ãƒã‚§ãƒƒã‚¯
GET /live      # ãƒ©ã‚¤ãƒ–ãƒã‚¹ãƒã‚§ãƒƒã‚¯
```

## ğŸ”§ è¨­å®š

è¨­å®šã¯`pydantic-settings`ã§ç®¡ç†ã•ã‚Œã¾ã™ã€‚ã™ã¹ã¦ã®è¨­å®šã¯ç’°å¢ƒå¤‰æ•°ã§ä¸Šæ›¸ãã§ãã¾ã™ã€‚

| è¨­å®š | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|-----------|------|
| `APP_NAME` | "AMI Server" | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å |
| `APP_VERSION` | "1.0.0" | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
| `DEBUG` | false | ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ |
| `DEFAULT_HOPS` | 1 | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¢ç´¢ãƒ›ãƒƒãƒ—æ•° |
| `MAX_HOPS` | 5 | æœ€å¤§æ¢ç´¢ãƒ›ãƒƒãƒ—æ•° |
| `DEFAULT_LIMIT` | 100 | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçµæœåˆ¶é™ |
| `MAX_LIMIT` | 1000 | æœ€å¤§çµæœåˆ¶é™ |

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
ami-server/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py              # pydantic-settingsã«ã‚ˆã‚‹è¨­å®š
â”‚   â”œâ”€â”€ main.py                # FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ auth.py            # èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ dependencies.py    # èªè¨¼ä¾å­˜æ€§æ³¨å…¥
â”‚   â”‚   â””â”€â”€ security.py        # JWTã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ neo4j.py           # Neo4jæ¥ç¶šç®¡ç†
â”‚   â”‚   â””â”€â”€ session.py         # SQLiteã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ graph.py           # ã‚°ãƒ©ãƒ•ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â””â”€â”€ user.py            # ãƒ¦ãƒ¼ã‚¶ãƒ¼SQLModel
â”‚   â””â”€â”€ routers/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ search.py          # æ¤œç´¢APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚       â”œâ”€â”€ network.py         # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¢ç´¢ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚       â””â”€â”€ cypher.py          # Cypherã‚¯ã‚¨ãƒªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆä¿è­·æ¸ˆã¿ï¼‰
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py            # ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
â”‚   â”œâ”€â”€ test_auth.py           # èªè¨¼ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ test_main.py
â”‚   â”œâ”€â”€ test_search.py
â”‚   â”œâ”€â”€ test_network.py
â”‚   â””â”€â”€ test_cypher.py
â”œâ”€â”€ schema/
â”‚   â””â”€â”€ neo4j_importer_model.json
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ requirements-dev.txt
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

## ğŸ“œ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã•ã‚Œã¦ã„ã¾ã™ã€‚
